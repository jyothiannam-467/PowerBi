Modelling > New Table
______________________________

Top10_PurchaseLines = 
TOPN(
    10, 
    'Purchase Lines', 
    'Purchase Lines'[Amount], 
    DESC
)
----------------------------------------------------------------
TopN_Sum = 
IF (
    RANKX(
        ALL('Purchase Orders'), 
        [TopN_Sum_Amount], 
        , 
        DESC
    ) <= 10, 
    [TopN_Sum_Amount], 
    BLANK()
)
----------------------------------------------------------------
Top 10 Purchase Orders = 
VAR SelectedLocation = SELECTEDVALUE('Purchase Orders'[Location_Code]) // Get the selected location from the slicer
VAR SelectedFiscalYear = SELECTEDVALUE('Date'[Fiscal Years]) // Get the selected fiscal year from the slicer
VAR TotalPurchaseAmount =                                               
    CALCULATE(
        SUM('Purchase Lines'[Amount])                 // Calculate the total amount of purchase lines
    )

RETURN
    FILTER(
        ADDCOLUMNS(
            SUMMARIZE(
                'Purchase Lines',
                'Purchase Lines'[Document_No],               // Group by Purchase Order No
                'Purchase Orders'[Location_Code],            // Include Location Code
                'Purchase Orders'[Status],                   // Include Status
                'Purchase Orders'[Buy_from_Vendor_No],      // Include Vendor
                'Purchase Orders'[Company Name],             // Include Company Name
                'Purchase Orders'[Posting_Date]              // Include Posting Date
            ),
            "TotalAmount", [TotalAmount475],         // Add Total Amount for each order
            "Rank",
            RANKX(
                CALCULATETABLE(                             // Apply ranking based on filtered records
                    'Purchase Lines',
                    KEEPFILTERS(ALL('Purchase Lines'[Document_No])),   // Keep all selected filters from the slicer
                    'Purchase Orders'[Location_Code] = SelectedLocation,
                     FORMAT(SelectedFiscalYear,'Purchase Orders'[Posting_Date])
                ),
                [TotalAmount475],[total] , DESC
            ),
             "TotalPurchaseAmount",CALCULATE(SUM('Purchase Lines'[Amount])),
             "PercentageOfTotal", 
                (([TotalAmount475]/TotalPurchaseAmount))        // Calculate percentage of the total
            
        ),
        [Rank] <= 10                                   // Show only the top 10 records based on rank
    )
